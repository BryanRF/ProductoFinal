{% extends 'master.html' %}
{% load static %}
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

{% block content %}
    <div class="container-fluid">
        <!-- Page Heading -->
        <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <h1 class="h3 mb-0 text-gray-800">Promociones</h1>
            <a href="{% url 'lista_promociones' %}" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">Mostrar Lista</a>
        </div>

        <!-- Content Row -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Agregar Promoción</h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <form method="post">
                        {% csrf_token %}
                        
                        <!-- Campos del formulario que deseas mostrar -->
                        <div class="mb-3">
                            <label for="{{ form.descripcion.id_for_label }}">Descripción:</label>
                            {{ form.descripcion }}
                        </div>
                        <div class="mb-3">
                            <label for="{{ form.fecha_inicio.id_for_label }}">Fecha de Inicio:</label>
                            {{ form.fecha_inicio }}
                        </div>
                        <div class="mb-3">
                            <label for="{{ form.fecha_fin.id_for_label }}">Fecha de Fin:</label>
                            {{ form.fecha_fin }}
                        </div>
                        <div class="mb-3 form-check">
                            {{ form.activo }} 
                        </div>
                        <div class="mb-3">
                            <label for="{{ form.tipo_cliente.id_for_label }}">Tipo Cliente:</label>
                            {{ form.tipo_cliente }}
                        </div>
                        <button id="mostrarArticulosBtn" class="btn btn-primary">Artículos</button>

                        <!-- Sección para mostrar los artículos (inicialmente oculta) -->
                        <div id="tablaArticulos" class="mt-4" style="display: none;">
                            <h5 class="mb-3">Artículos</h5>
                            <table class="table">
                                <!-- ... (cabecera de la tabla) ... -->
                                <tbody>
                                    {% for articulo in articulos %}
                                        <tr>
                                            <!-- Caja de selección para cada artículo -->
                                            <td>
                                                <input type="checkbox" name="articulosSeleccionados" value="{{ articulo.id }}">
                                            </td>
                                            <!-- Campos de información del artículo -->
                                            <td>{{ articulo.codigo_sku }}</td>
                                            <td>{{ articulo.descripcion }}</td>
                                            <!-- ... (otros campos relevantes) ... -->
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            <button id="aceptarArticulosBtn" class="btn btn-primary mt-3">Aceptar</button>
                        </div>

                        <!-- Tabla para mostrar los artículos seleccionados -->
                        <div id="articulosSeleccionados" class="mt-4" style="display: none;">
                            <h5 class="mb-3">Artículos Seleccionados</h5>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Código SKU</th>
                                        <th>Descripción</th>
                                        <th>Cantidad</th>
                                        <!-- ... (otros campos relevantes) ... -->
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Aquí se mostrarán los artículos seleccionados -->
                                </tbody>
                            </table>
                            <button type="submit" class="btn btn-primary mt-3">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('mostrarArticulosBtn').addEventListener('click', function () {
            var tablaArticulos = document.getElementById('tablaArticulos');
            tablaArticulos.style.display = (tablaArticulos.style.display === 'none' || tablaArticulos.style.display === '') ? 'block' : 'none';
        });

        document.getElementById('aceptarArticulosBtn').addEventListener('click', function () {
            var tablaArticulos = document.getElementById('tablaArticulos');
            var articulosSeleccionados = document.getElementById('articulosSeleccionados');
            
            // Limpia la tabla de artículos seleccionados
            var tbody = document.querySelector('#articulosSeleccionados tbody');
            tbody.innerHTML = '';

            // Obtiene los artículos seleccionados
            var articulosCheckbox = document.getElementsByName('articulosSeleccionados');
            for (var i = 0; i < articulosCheckbox.length; i++) {
                if (articulosCheckbox[i].checked) {
                    var articuloId = articulosCheckbox[i].value;
                    var articulo = obtenerArticuloPorId(articuloId);
                    
                    // Agrega el artículo a la tabla de artículos seleccionados
                    var row = tbody.insertRow();
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);
                    var cell3 = row.insertCell(2);
                    cell1.innerHTML = articulo.codigo_sku;
                    cell2.innerHTML = articulo.descripcion;
                    cell3.innerHTML = '<input type="number" name="cantidades[]" value="1" min="1">';
                    // ... (otros campos relevantes) ...
                }
            }

            // Muestra la tabla de artículos seleccionados
            articulosSeleccionados.style.display = 'block';
        });

        // Función para obtener la información de un artículo por ID
        function obtenerArticuloPorId(articuloId) {
            // Obtiene el elemento del formulario con el ID del artículo
            var articuloElement = document.querySelector('[value="' + articuloId + '"]');
            
            // Obtiene la información del artículo directamente desde el formulario
            return {
                codigo_sku: articuloElement.parentElement.nextElementSibling.textContent,
                descripcion: articuloElement.parentElement.nextElementSibling.nextElementSibling.textContent,
                // ... (otros campos relevantes) ...
            };
        }
    </script>
{% endblock %}
